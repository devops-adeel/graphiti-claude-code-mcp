# Test runner Dockerfile for Langfuse MCP integration tests
FROM python:3.11-slim

WORKDIR /app

# Install netcat for health checks
RUN apt-get update && apt-get install -y netcat-openbsd && \
    rm -rf /var/lib/apt/lists/*

# Copy requirements and install dependencies
COPY requirements.txt ./
RUN pip install --no-cache-dir -r requirements.txt && \
    pip install pytest pytest-asyncio pytest-cov

# Copy the entire project
COPY . .

# Set environment variables for testing
ENV PYTHONPATH=/app
ENV LOG_LEVEL=ERROR
ENV NEO4J_URI=bolt://neo4j.graphiti.local:7687
ENV NEO4J_USER=neo4j
ENV LANGFUSE_HOST=http://langfuse.local

# Default command runs all tests
CMD ["python", "-m", "pytest", "tests/test_langfuse*.py", "-v"]

# MCP Server Docker Image for Claude Code Integration
FROM python:3.11-slim

# Set working directory
WORKDIR /app

# Install system dependencies if needed
RUN apt-get update && apt-get install -y --no-install-recommends \
    gcc \
    && rm -rf /var/lib/apt/lists/*

# Copy project configuration first (for better layer caching)
COPY pyproject.toml ./

# Install Python dependencies
RUN pip install --no-cache-dir -e .

# Copy application code
COPY graphiti_memory.py ./
COPY capture.py ./
COPY commands.py ./
COPY mcp_server.py ./

# Copy the stdio wrapper
COPY mcp_stdio_wrapper.py ./

# Environment variables will be mounted at runtime
# No sensitive data in the image

# Use unbuffered output for real-time stdio communication
ENV PYTHONUNBUFFERED=1

# Entry point for stdio MCP server
ENTRYPOINT ["python", "mcp_stdio_wrapper.py"]